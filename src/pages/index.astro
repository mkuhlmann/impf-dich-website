---
import Layout from '../layouts/Layout.astro';
import Card from '../components/Card.astro';
import Footer from '@/components/Footer.astro';
import 'leaflet/dist/leaflet.css';
import Navbar from '@/components/Navbar.astro';

import fbox1 from '../assets/fbox-1.jpg';
import fbox2 from '../assets/fbox-2.jpg';
import fbox3 from '../assets/fbox-3.jpg';
import schueler from '@/assets/schueler.jpg';

const lokalgruppen = await Astro.glob('./de/lokalgruppen/*.md');
---

<Layout title="Home">
	<div class="absolute top-0" style="height: 450px; z-index: -100;transform: scaleX(-1) ">
		<svg data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1200 100" preserveAspectRatio="none" style="height: 450px; width: 100%;  ">
			<path d="M0,0 L0,100 1200,0 1200,0" style="fill: var(--color-blue-primary);"></path>
			<path d="M0,0 L0,60 1200,0 1200,0" style="fill: #fff;"></path>
			<path d="M0,0 L0,30 1200,0 1200,0" style="fill: var(--color-blue-secondary);"></path>
		</svg>
	</div>

	<Navbar />

	<main style="margin-top: 150px;">
		<div class="md:flex container mx-auto items-center">
			<div class="max-w-2xl p-5">
				<h2 class="text-3xl font-heading mb-5">Schütze Dich und andere</h2>

				<h1 class="text-6xl font-bold font-heading"><span class="text-impf">Impf</span> <span class="text-impf-2">Dich</span>.</h1>

				<!-- <div class="text-xl">Mach mit bei der Impf-Initiative und helfe, die Verbreitung von Krankheiten zu stoppen. Impf Dich - für eine gesündere Zukunft!</div> -->

				<div class="mt-10 flex flex-col lg:flex-row gap-5">
					<a href="/de/lokalgruppen/mitmachen" class="rounded bg-impf hover:bg-sky-600 text-white text-xl flex py-3 px-5 gap-2 items-center cursor-pointer">
						<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-6 h-6"
							><title>hand-wave-outline</title><path
								d="M7.03 4.95L3.5 8.5C.17 11.81 .17 17.19 3.5 20.5S12.19 23.83 15.5 20.5L21.5 14.5C22.5 13.53 22.5 11.94 21.5 10.96C21.4 10.84 21.27 10.73 21.13 10.64L21.5 10.25C22.5 9.28 22.5 7.69 21.5 6.71C21.36 6.55 21.17 6.41 21 6.3C21.38 5.38 21.21 4.28 20.46 3.53C19.59 2.66 18.24 2.57 17.26 3.25C17.16 3.1 17.05 2.96 16.92 2.83C15.95 1.86 14.36 1.86 13.38 2.83L10.87 5.34C10.78 5.2 10.67 5.07 10.55 4.95C9.58 4 8 4 7.03 4.95M8.44 6.37C8.64 6.17 8.95 6.17 9.15 6.37S9.35 6.88 9.15 7.08L5.97 10.26C7.14 11.43 7.14 13.33 5.97 14.5L7.38 15.91C8.83 14.46 9.2 12.34 8.5 10.55L14.8 4.25C15 4.05 15.31 4.05 15.5 4.25S15.71 4.76 15.5 4.96L10.91 9.56L12.32 10.97L18.33 4.96C18.53 4.76 18.84 4.76 19.04 4.96C19.24 5.16 19.24 5.47 19.04 5.67L13.03 11.68L14.44 13.09L19.39 8.14C19.59 7.94 19.9 7.94 20.1 8.14C20.3 8.34 20.3 8.65 20.1 8.85L14.44 14.5L15.85 15.92L19.39 12.38C19.59 12.18 19.9 12.18 20.1 12.38C20.3 12.58 20.3 12.89 20.1 13.09L14.1 19.1C11.56 21.64 7.45 21.64 4.91 19.1S2.37 12.45 4.91 9.91L8.44 6.37M23 17C23 20.31 20.31 23 17 23V21.5C19.5 21.5 21.5 19.5 21.5 17H23M1 7C1 3.69 3.69 1 7 1V2.5C4.5 2.5 2.5 4.5 2.5 7H1Z"
							></path></svg
						>
						Mitmachen</a
					>

					<a href="/de/impfpasscheck" class="rounded bg-green-500 hover:bg-green-600 text-white text-xl flex py-3 px-5 gap-2 items-center cursor-pointer">
						<svg aria-hidden="true" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" class="w-6 h-6">
							<path
								d="M9 12.75L11.25 15 15 9.75m-3-7.036A11.959 11.959 0 013.598 6 11.99 11.99 0 003 9.749c0 5.592 3.824 10.29 9 11.623 5.176-1.332 9-6.03 9-11.622 0-1.31-.21-2.571-.598-3.751h-.152c-3.196 0-6.1-1.248-8.25-3.285z"
								stroke-linecap="round"
								stroke-linejoin="round"></path>
						</svg>
						Impfpass-Check</a
					>
				</div>
			</div>

			<div class="hidden md:block md:ml-auto rounded-md lg:-mr-20 overflow-hidden md:overflow-visible border-gray-200 shadow-lg ease-in-out duration-500 rotate-1 hover:rotate-3">
				<img src={schueler.src} class="object-cover w-[700px] h-[400px] rounded-md" />
			</div>
		</div>

		<div class="container mx-auto mb-10 mt-14 p-5">
			<div class="flex flex-col md:flex-row gap-5">
				<div class="flex-1 bg-gray-200 p-5 rounded-xl shadow-sm ease-in-out duration-500 hover:scale-105">
					<h2 class="text-center text-2xl mb-3">Aufklären</h2>
					<img src={fbox1.src} width={fbox1.width} height={fbox1.height} alt="Aufklären" />
				</div>
				<div class="flex-1 bg-gray-200 p-5 rounded-xl shadow-sm ease-in-out duration-500 hover:scale-105">
					<h2 class="text-center text-2xl mb-3">Forschen</h2>
					<img src={fbox3.src} width={fbox3.width} height={fbox3.height} alt="Aufklären" />
				</div>
				<div class="flex-1 bg-gray-200 p-5 rounded-xl shadow-sm ease-in-out duration-500 hover:scale-105">
					<h2 class="text-center text-2xl mb-3">Impformieren</h2>
					<img src={fbox2.src} width={fbox2.width} height={fbox2.height} alt="Aufklären" />
				</div>
			</div>
		</div>

		<div>
			<div class="container mx-auto">
				<div class="absolute text-white mt-10" style="opacity: 0.3;">
					<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-60 h-60">
						<path
							fill-rule="evenodd"
							d="M11.54 22.351l.07.04.028.016a.76.76 0 00.723 0l.028-.015.071-.041a16.975 16.975 0 001.144-.742 19.58 19.58 0 002.683-2.282c1.944-1.99 3.963-4.98 3.963-8.827a8.25 8.25 0 00-16.5 0c0 3.846 2.02 6.837 3.963 8.827a19.58 19.58 0 002.682 2.282 16.975 16.975 0 001.145.742zM12 13.5a3 3 0 100-6 3 3 0 000 6z"
							clip-rule="evenodd"></path>
					</svg>
				</div>
			</div>
			<svg data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 800 30" preserveAspectRatio="none" style="height: 82px; width: 100%;">
				<path d="M0,0 L1200,30 0,30" style="fill: rgb(55, 65, 81);"></path>
			</svg>
		</div>

		<div class="bg-gray-700">
			<div class="container mx-auto text-white p-5">
				<div class="flex flex-col md:flex-row">
					<div class="flex-1 z-10">
						<h2 class="text-gray-200">Aufklärung in der Nähe</h2>
						<h1 class="text-3xl font-bold mb-5 heading">Lokalgruppen</h1>
						<div class="grid grid-cols-3 xl:grid-cols-4 gap-5 lg:pr-10">
							{
								lokalgruppen.map((lokalgruppe) => (
									<a href={lokalgruppe.url} class="text-white text-center text-lg p-3 cursor-pointer bg-gray-500 opacity-90 rounded-lg hover:opacity-100">
										{lokalgruppe.frontmatter.title}
									</a>
								))
							}
						</div>
					</div>

					<div id="lgmap" class="hidden lg:block flex-1 rounded-xl" style="height: 450px; z-index: 0; width:100%;"></div>
				</div>

				<div
					id="lglokal"
					class="hidden"
					set:html={JSON.stringify(
						lokalgruppen.map((lokalgruppe) => {
							return {
								name: lokalgruppe.frontmatter.title,
								href: lokalgruppe.url,
								coords: [lokalgruppe.frontmatter.latitude, lokalgruppe.frontmatter.longitude],
							};
						})
					)}
				/>

				<script>
					/* @ts-ignore */
					import * as L from 'leaflet';

					var map = L.map('lgmap').setView([51.389078060389295, 10.340330121508005], 6);

					L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
						attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
					}).addTo(map);

					var lokalgruppen = JSON.parse(document.querySelector('#lglokal')!.innerHTML);

					// async function geocode(city, apiKey) {
					// 	let json = await fetch('https://maps.googleapis.com/maps/api/geocode/json?address=' + city + ', Germany' + '&key=' + apiKey).then((r) => r.json());

					// 	if (!json || !json.results.length > 0) {
					// 		console.error('error geocoding city: ' + city);
					// 	}
					// 	return [json.results[0].geometry.location.lat, json.results[0].geometry.location.lng];
					// }

					lokalgruppen.forEach(function (lokalgruppe: any) {
						L.marker(lokalgruppe.coords)
							.addTo(map)
							.bindPopup('<div><strong>' + lokalgruppe.name + '</strong><br><a href="' + lokalgruppe.href + '">Zur Lokalgruppenseite</a></div>');
					});
				</script>
			</div>
		</div>

		<div>
			<svg data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 800 30" preserveAspectRatio="none" style="height: 80px; width: 100%;  ">
				<path d="M0,0 L1200,0 1200,30" style="fill: rgb(55, 65, 81);"></path>
			</svg>
		</div>

		<div class="container mx-auto">
			<div class="content mb-10 px-5">
				<h1 class="text-3xl font-bold mb-5 font-heading">Instagram</h1>
				<script>
					fetch('http://localhost:8000/api/instagram/feed')
						.then((r) => r.json())
						.then((r) => {
							console.log(r);

							const container = document.querySelector('#ig-container')!;
							for (let i = 0; i < r.length && i < 10; i++) {
								const post = r[i];
								container.innerHTML += `<div class="p-2"><a href="${post.permalink}" target="_blank"><img src="http://localhost:8000/instagram/image/${post.id}" alt="${post.caption}" class="rounded-lg"></a></div>`;
							}
						});
				</script>
				<div class="grid grid-cols-5 gap-5 items-center justify-center" id="ig-container"></div>
			</div>
		</div>
	</main>

	<Footer />
</Layout>

<style>
	.footer {
		border-top: 6px solid var(--color-blue-primary);
	}
</style>
